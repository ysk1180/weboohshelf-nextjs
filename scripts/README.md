# スクリプト

このディレクトリには、メンテナンスや修正用のスクリプトが含まれています。

## fix-sequence.js

PostgreSQLのシーケンス（自動採番）を修正するスクリプトです。

### 問題の背景
データベースのマイグレーションやインポート時に、シーケンスが正しく更新されないことがあります。
その結果、新しいレコードのIDが古い値で作成され、「最新の本棚」が正しく表示されない問題が発生します。

### 使用方法
```bash
node scripts/fix-sequence.js
```

### 実行例
```
=== Bookshelfテーブルのシーケンスを修正します ===

現在の最大ID: 1729
現在のシーケンス値: 58
シーケンスを 1730 に修正しました
修正後のシーケンス値: 1730

=== 完了 ===
```

### 注意事項
- 本番環境で実行する前に、必ずバックアップを取ってください
- 複数の開発者が同時に実行しないよう注意してください

## fix-all-sequences.js

全テーブルのPostgreSQLシーケンス（自動採番）を修正するスクリプトです。

### 使用方法
```bash
node scripts/fix-all-sequences.js
```

### 実行例
```
=== 全テーブルのシーケンスを修正します ===

--- Bookテーブルの処理中 ---
現在の最大ID: 4321
現在のシーケンス値: 131
シーケンスを 4322 に修正しました
修正後のシーケンス値: 4322

--- Bookshelfテーブルの処理中 ---
現在の最大ID: 1729
現在のシーケンス値: 1737
シーケンスは既に正しい値です

--- BookshelfBookテーブルの処理中 ---
現在の最大ID: 5778
現在のシーケンス値: 191
シーケンスを 5779 に修正しました
修正後のシーケンス値: 5779

=== 完了 ===
```

### 対象テーブル
- Book
- Bookshelf
- BookshelfBook